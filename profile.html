<div class="profile-container">
  <div class="avatar" id="avatar">
    <div class="avatar-placeholder">üë§</div>
  </div>
  <input type="file" id="uploadAvatar" class="hidden" accept="image/*" onchange="previewAvatar(event)" />
  <button class="btn" onclick="document.getElementById('uploadAvatar').click()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</button>

  <h2>–í–∞—à–µ –∏–º—è: <span id="user-name">–ì–æ—Å—Ç—å</span></h2>
  <button class="btn" id="editNameBtn" onclick="toggleNameEdit()" style="display:none;">–ò–∑–º–µ–Ω–∏—Ç—å –∏–º—è</button>

  <div id="nameEdit" class="hidden">
    <input type="text" id="newName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è">
    <button class="btn" onclick="saveName()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>

  <p class="muted" id="email">Email: ‚Äî</p>
  <p class="muted" id="registered">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ‚Äî</p>

  <!-- –Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
  <button class="btn" id="authBtn" onclick="openAuth()">–í–æ–π—Ç–∏ / –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>

  <div class="lang">
    <button onclick="setLang('ru')" id="btn-ru" class="active">RU</button>
    <button onclick="setLang('en')" id="btn-en">EN</button>
  </div>
</div>

<!-- AUTH MODAL -->
<div class="modal" id="authModal">
  <div class="modal-content">
    <h2>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <input type="email" id="emailInput" placeholder="Email" />
    <input type="password" id="passwordInput" placeholder="–ü–∞—Ä–æ–ª—å" />
    <button class="btn" onclick="loginUser()">–í–æ–π—Ç–∏</button>
    <button class="btn" onclick="registerUser()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    <button class="btn" onclick="closeAuth()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<script>
  const supabaseUrl = "https://rjqeqffegmejiyakhxza.supabase.co";
  const supabaseKey = "YOUR_KEY_HERE";
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

  async function loadProfile() {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      document.getElementById("user-name").textContent = "–ì–æ—Å—Ç—å";
      document.getElementById("email").textContent = "Email: ‚Äî";
      document.getElementById("registered").textContent = "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ‚Äî";
      document.getElementById("editNameBtn").style.display = "none";
      return;
    }
    document.getElementById("user-name").textContent = user.user_metadata.username || "–ë–µ–∑ –∏–º–µ–Ω–∏";
    document.getElementById("email").textContent = "Email: " + user.email;
    document.getElementById("registered").textContent = "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: " + new Date(user.created_at).toLocaleDateString();
    document.getElementById("editNameBtn").style.display = "inline-block";
    document.getElementById("authBtn").style.display = "none"; // –µ—Å–ª–∏ –≤–æ—à—ë–ª ‚Äî –∫–Ω–æ–ø–∫—É –≤—Ö–æ–¥–∞ —Å–∫—Ä—ã–≤–∞–µ–º
  }

  function openAuth() {
    document.getElementById("authModal").style.display = "flex";
  }

  function closeAuth() {
    document.getElementById("authModal").style.display = "none";
  }

  async function loginUser() {
    const email = document.getElementById("emailInput").value;
    const password = document.getElementById("passwordInput").value;
    const { error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) { alert("–û—à–∏–±–∫–∞: " + error.message); return; }
    closeAuth();
    location.reload();
  }

  async function registerUser() {
    const email = document.getElementById("emailInput").value;
    const password = document.getElementById("passwordInput").value;
    const { error } = await supabase.auth.signUp({ email, password });
    if (error) { alert("–û—à–∏–±–∫–∞: " + error.message); return; }
    alert("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è");
    closeAuth();
  }

  // –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (toggleNameEdit, saveName, previewAvatar, setLang) –æ—Å—Ç–∞–≤–ª—è–µ–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

  loadProfile();
</script>
